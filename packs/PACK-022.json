{
  "v": 1,
  "pack_id": "PACK-022",
  "title": "EPIC-005: Auth Middleware - JWT Verification & Claims Injection",
  "epic": {
    "id": "EPIC-005",
    "title": "Cross-Cutting Concerns - Auth, Validation, Errors, Observability, Config",
    "goal": "Implement production-ready concerns: JWT auth middleware, input validation, error handling, structured logging, metrics, configuration management"
  },
  "stories": [
    "STORY-022"
  ],
  "story_type": "security",
  "related_nodes": [
    6,
    7,
    23,
    47,
    59,
    61,
    71
  ],
  "depends_on": [
    "STORY-013",
    "STORY-014"
  ],
  "deliverables": [
    "Production-ready implementation strictly for this story scope",
    "Automated tests required by acceptance criteria",
    "Minimal documentation/README updates required to run/test the change"
  ],
  "acceptance_criteria": [
    "FastAPI dependency extracts Authorization header (Bearer token)",
    "Call JWT Validator to verify token and extract claims",
    "Inject claims (user_id, is_admin) into request context (FastAPI depends)",
    "Return 401 Unauthorized if token invalid, expired, or missing",
    "Admin-only routes check is_admin=true, return 403 Forbidden if false",
    "Unit tests with valid/invalid/expired tokens, integration tests verify protection"
  ],
  "description": "Implement FastAPI dependency for JWT auth: extract token from header, verify via JWT Validator, inject user_id and is_admin into request context, protect admin routes.",
  "constraints": {
    "no_arch_changes": true,
    "no_scope_creep": true,
    "follow_graph": true
  }
}
